<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rust Calling Card Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* (Use the same CSS from the previous "Pro" version I gave you. 
           For brevity, I am keeping the styles standard, but make sure to 
           copy the CSS from the previous "Pro" reply if you want that look!) */
        
        body { background-color: #121212; color: #eee; font-family: 'Roboto', sans-serif; display: flex; flex-direction: column; align-items: center; }
        h1 { font-family: 'Black Ops One', cursive; color: #ce422b; margin-top: 20px; }
        .canvas-wrapper { border: 2px solid #ce422b; margin: 20px; box-shadow: 0 0 20px rgba(206,66,43,0.3); }
        .controls { margin-top: 10px; display: flex; gap: 10px; }
        button { padding: 10px 20px; background: #333; color: white; border: 1px solid #555; cursor: pointer; }
        button.save { background: #ce422b; font-weight: bold; border-color: #e05e46; }
        button.save:hover { background: #e05e46; }
    </style>
</head>
<body>

    <h1 id="pageTitle">KillaDome Emblem Editor</h1>
    
    <div class="canvas-wrapper">
        <canvas id="c" width="1133" height="207"></canvas>
    </div>

    <div class="controls">
        <button onclick="addText()">Add Text</button>
        <button onclick="addCircle()">Add Circle</button>
        <button class="save" onclick="exportImage()">SAVE & UPLOAD</button>
    </div>

    <script>
        const canvas = new fabric.Canvas('c', { backgroundColor: '#000000' });
        
        // --- AUTO-LOGIN LOGIC ---
        let autoSteamId = null;
        
        window.onload = function() {
            // Check URL for ?id=7656...
            const params = new URLSearchParams(window.location.search);
            if (params.has('id')) {
                autoSteamId = params.get('id');
                document.getElementById('pageTitle').innerHTML += `<br><span style="font-size:16px; color:#4caf50;">Linked to SteamID: ${autoSteamId}</span>`;
            }
        };

        // --- ASSETS (Simplified for this snippet, add your full library here) ---
        function addCircle() { 
            canvas.add(new fabric.Circle({ radius: 30, fill: '#ce422b', left: 100, top: 50 })); 
        }
        function addText() {
            canvas.add(new fabric.IText('NICKNAME', { left: 50, top: 50, fill: 'white', fontFamily: 'Black Ops One' }));
        }

        // --- EXPORT FUNCTION ---
        function exportImage() {
            // 1. Get user ID
            let targetId = autoSteamId;
            if (!targetId) {
                targetId = prompt("No SteamID found in URL. Enter Steam64 ID manually:");
            }
            if (!targetId) return;

            // 2. Prepare Data
            canvas.discardActiveObject();
            canvas.requestRenderAll();
            const dataURL = canvas.toDataURL({ format: 'png', quality: 1, multiplier: 1 });

            // 3. Send to DigitalOcean Bridge
            // IMPORTANT: You will replace 127.0.0.1 with your VPS IP later!
            const BRIDGE_URL = "http://YOUR_DIGITALOCEAN_IP:3000/upload";

            fetch(BRIDGE_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ steamId: targetId, imageData: dataURL })
            })
            .then(res => res.json())
            .then(data => {
                alert("Success! Emblem sent to server.");
            })
            .catch(err => {
                console.error(err);
                alert("Failed to connect to Bridge. Is the VPS running?");
            });
        }
    </script>
</body>
</html>
